<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ÖestVèl Signal Control - AS-20260203-0834</title>
    <style>
        body { 
            background: #1a1a1a; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            font-family: 'Arial', sans-serif;
        }

        /* The Signal Post */
        .signal-housing {
            width: 180px;
            background: linear-gradient(145deg, #333, #111);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8), inset 0 2px 5px rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            border: 2px solid #444;
        }

        /* Lights */
        .light {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #222;
            border: 4px solid #111;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.6);
            transition: all 0.2s ease;
        }

        .red.active { background: #ff0000; box-shadow: 0 0 40px #ff0000, inset 0 0 20px #800000; }
        .amber.active { background: #ffaa00; box-shadow: 0 0 40px #ffaa00, inset 0 0 20px #805500; }
        .green.active { background: #00ff00; box-shadow: 0 0 40px #00ff00, inset 0 0 20px #008000; }

        /* The Pedestrian Button Box */
        .button-box {
            margin-top: 30px;
            width: 120px;
            height: 150px;
            background: #f1c40f; /* High visibility yellow */
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid #b7950b;
            box-shadow: 0 10px 0 #917608;
            transition: transform 0.1s;
        }

        .button-box:active { transform: translateY(5px); box-shadow: 0 5px 0 #917608; }

        .wait-panel {
            width: 80%;
            height: 40px;
            background: #222;
            color: #444;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 14px;
            letter-spacing: 2px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .wait-panel.active { color: #f1c40f; text-shadow: 0 0 5px #f1c40f; }

        .round-button {
            width: 50px;
            height: 50px;
            background: #ddd;
            border-radius: 50%;
            border: 3px solid #999;
        }

        .status-text { margin-top: 20px; color: #666; font-size: 12px; }
    </style>
</head>
<body>

    <div class="signal-housing">
        <div id="light-red" class="light red active"></div>
        <div id="light-amber" class="light amber"></div>
        <div id="light-green" class="light green"></div>

        <div class="button-box" onclick="requestCross()">
            <div id="wait-light" class="wait-panel">WAIT</div>
            <div class="round-button"></div>
        </div>
        <div class="status-text">REF: AS-20260203-0834</div>
    </div>

    <script>
        let isWaiting = false;
        let isSequenceRunning = false;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playBeep(frequency, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(frequency, audioCtx.currentTime);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function setLights(r, a, g) {
            document.getElementById('light-red').classList.toggle('active', r);
            document.getElementById('light-amber').classList.toggle('active', a);
            document.getElementById('light-green').classList.toggle('active', g);
        }

        async function requestCross() {
            if (isWaiting || isSequenceRunning) return;
            
            isWaiting = true;
            document.getElementById('wait-light').classList.add('active');
            
            // Simulate the delay for the AI to find a gap in traffic
            setTimeout(startSequence, 3000);
        }

        async function startSequence() {
            isSequenceRunning = true;
            
            // Green to Amber
            setLights(false, true, false);
            await new Promise(r => setTimeout(r, 2000));
            
            // Amber to Red
            setLights(true, false, false);
            document.getElementById('wait-light').classList.remove('active');
            
            // Pedestrian "Green" Phase (with sound)
            const beepInterval = setInterval(() => playBeep(880, 0.1), 200);
            await new Promise(r => setTimeout(r, 5000));
            
            clearInterval(beepInterval);
            
            // Back to Normal
            setLights(true, true, false); // Red + Amber
            await new Promise(r => setTimeout(r, 1500));
            setLights(false, false, true);
            
            isWaiting = false;
            isSequenceRunning = false;
        }

        // Initialize at Green for traffic
        setLights(false, false, true);
    </script>
</body>
</html>
