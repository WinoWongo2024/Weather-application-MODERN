<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ÖestVèl High-Detail Signal - AS-20260203-0834</title>
    <style>
        body { 
            background: #0f0f0f; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; margin: 0;
            user-select: none;
        }

        /* High-Detail Signal Housing */
        .housing {
            width: 200px;
            background: linear-gradient(to bottom, #333 0%, #1a1a1a 100%);
            padding: 40px 20px;
            border-radius: 40px;
            border: 4px solid #444;
            box-shadow: 20px 20px 60px #050505, -5px -5px 20px #222;
            display: flex;
            flex-direction: column;
            gap: 25px;
            position: relative;
        }

        /* Lens Detailing */
        .light {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #111;
            position: relative;
            border: 8px solid #000;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.9);
        }

        /* Fresnel Lens Effect */
        .light::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-radial-gradient(circle, transparent 0, transparent 5px, rgba(0,0,0,0.3) 6px);
            pointer-events: none;
        }

        /* Active States */
        .red.active { background: #ff0000; box-shadow: 0 0 60px #ff0000, inset 0 0 30px #4d0000; }
        .orange.active { background: #ff8c00; box-shadow: 0 0 60px #ff8c00, inset 0 0 30px #4d2a00; }
        .green.active { background: #00ff22; box-shadow: 0 0 60px #00ff22, inset 0 0 30px #004d0b; }

        /* The Button Unit */
        .btn-unit {
            margin-top: 30px;
            width: 140px;
            height: 160px;
            background: #e67e22; /* ÖestVèl Orange-Yellow */
            border-radius: 15px;
            border: 4px solid #222;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            cursor: pointer;
        }

        .wait-display {
            width: 90%;
            height: 40px;
            background: #000;
            color: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            border-radius: 5px;
            margin-bottom: 20px;
            transition: 0.1s;
        }

        .wait-display.active { color: #ff0000; text-shadow: 0 0 10px #ff0000; }

        .press-btn {
            width: 60px;
            height: 60px;
            background: #ccc;
            border-radius: 50%;
            border: 4px solid #666;
            box-shadow: inset 0 4px 0 #fff, 0 4px 0 #444;
        }

        .press-btn:active { transform: translateY(2px); box-shadow: none; }
    </style>
</head>
<body>

    <div class="housing">
        <div id="L-RED" class="light red active"></div>
        <div id="L-ORG" class="light orange"></div>
        <div id="L-GRN" class="light green"></div>

        <div class="btn-unit" onclick="triggerSequence()">
            <div id="WAIT" class="wait-display">WAIT</div>
            <div class="press-btn"></div>
        </div>
    </div>

    <script>
        const lights = {
            red: document.getElementById('L-RED'),
            org: document.getElementById('L-ORG'),
            grn: document.getElementById('L-GRN'),
            wait: document.getElementById('WAIT')
        };

        let running = false;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function beep(freq, dur) {
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.connect(g); g.connect(audioCtx.destination);
            osc.frequency.value = freq; g.gain.value = 0.05;
            osc.start(); osc.stop(audioCtx.currentTime + dur);
        }

        function set(r, o, g) {
            lights.red.classList.toggle('active', r);
            lights.org.classList.toggle('active', o);
            lights.grn.classList.toggle('active', g);
        }

        async function flashOrange(times, speed) {
            for(let i=0; i<times; i++) {
                lights.org.classList.add('active');
                await new Promise(r => setTimeout(r, speed));
                lights.org.classList.remove('active');
                await new Promise(r => setTimeout(r, speed));
            }
        }

        async function triggerSequence() {
            if(running) return;
            running = true;
            
            // 1. Initial State: Green
            set(false, false, true);
            lights.wait.classList.add('active');
            beep(440, 0.1); // Click sound
            
            await new Promise(r => setTimeout(r, 2000));

            // 2. GREEN -> RED Transition
            // Green -> Orange Flashing -> Red (2x Flash)
            set(false, false, true); 
            await new Promise(r => setTimeout(r, 1000));
            set(false, false, false); 
            await flashOrange(4, 250); // Orange Flashing
            
            // Red (Double Flash) then Solid
            for(let i=0; i<2; i++) {
                set(true, false, false); await new Promise(r => setTimeout(r, 200));
                set(false, false, false); await new Promise(r => setTimeout(r, 200));
            }
            set(true, false, false);
            lights.wait.classList.remove('active');

            // 3. Pedestrian "Walk" Phase
            const walkSnd = setInterval(() => beep(1000, 0.05), 150);
            await new Promise(r => setTimeout(r, 5000));
            clearInterval(walkSnd);

            // 4. RED -> GREEN Transition
            // Red -> Red + Orange Flashing -> Green
            lights.red.classList.add('active');
            // Flash orange while red is still on
            for(let i=0; i<3; i++) {
                lights.org.classList.add('active');
                await new Promise(r => setTimeout(r, 300));
                lights.org.classList.remove('active');
                await new Promise(r => setTimeout(r, 300));
            }
            
            set(false, false, true); // Final Green
            running = false;
        }

        // Boot state
        set(false, false, true);
    </script>
</body>
</html>
